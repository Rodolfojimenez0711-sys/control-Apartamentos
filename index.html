<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Control de Apartamentos</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  font-family: Arial, sans-serif;
  background: #f3f4f6;
  padding: 20px;
  font-size: 18px;
}

h1 { text-align:center; }

.card {
  background: #fff;
  padding: 18px;
  border-radius: 14px;
  margin-bottom: 18px;
  box-shadow: 0 4px 12px rgba(0,0,0,.1);
}

input, button {
  padding: 12px;
  margin: 6px 0;
  font-size: 18px;
}

button {
  background: #2563eb;
  color: #fff;
  border: none;
  border-radius: 8px;
  cursor: pointer;
}

.apartment {
  border: 2px solid #e5e7eb;
  border-radius: 14px;
  padding: 14px;
  margin-top: 14px;
  position: relative;
}

.delete-apartment {
  position: absolute;
  top: 10px;
  right: 12px;
  font-size: 22px;
  color: red;
  cursor: pointer;
}

.row {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
}

.row input {
  flex: 1;
}

.item {
  display: flex;
  justify-content: space-between;
  background: #f9fafb;
  padding: 10px;
  border-radius: 8px;
  margin-top: 6px;
}

.small {
  font-size: 14px;
  color: #555;
}

.total {
  font-weight: bold;
  margin-top: 10px;
}
</style>
</head>

<body>

<h1>Control de Apartamentos</h1>

<div class="card">
  <h3>Agregar apartamento</h3>
  <input id="nuevoNombre" placeholder="Nombre del apartamento">
  <input id="nuevoIngresoMonto" type="number" inputmode="numeric" placeholder="Ingreso mensual">
  <input id="nuevoIngresoDesc" placeholder="Descripción del ingreso">
  <button onclick="agregarApartamento()">Agregar</button>
</div>

<div class="card">
  <button onclick="cambiarMoneda()">Cambiar moneda</button>
  <div id="monedaLabel"></div>
</div>

<div id="lista"></div>

<script>
let moneda = localStorage.getItem("moneda") || "CRC";
let apartamentos = JSON.parse(localStorage.getItem("apartamentos")) || [];

function guardar() {
  localStorage.setItem("apartamentos", JSON.stringify(apartamentos));
  localStorage.setItem("moneda", moneda);
}

function formato(valor) {
  return new Intl.NumberFormat(
    moneda === "CRC" ? "es-CR" : "en-US",
    { style: "currency", currency: moneda }
  ).format(valor || 0);
}

function cambiarMoneda() {
  moneda = moneda === "CRC" ? "USD" : "CRC";
  guardar();
  render();
}

function agregarApartamento() {
  const nombre = nuevoNombre.value;
  const monto = Number(nuevoIngresoMonto.value || 0);
  const desc = nuevoIngresoDesc.value;

  if (!nombre) return;

  apartamentos.push({
    nombre,
    ingreso: { monto, desc },
    gastos: []
  });

  nuevoNombre.value = "";
  nuevoIngresoMonto.value = "";
  nuevoIngresoDesc.value = "";
  guardar();
  render();
}

function agregarGasto(i) {
  const monto = Number(document.getElementById(`gastoMonto-${i}`).value || 0);
  const desc = document.getElementById(`gastoDesc-${i}`).value;
  if (!monto) return;

  apartamentos[i].gastos.push({ monto, desc });
  guardar();
  render();
}

function eliminarGasto(i, g) {
  apartamentos[i].gastos.splice(g, 1);
  guardar();
  render();
}

function eliminarApartamento(i) {
  if (confirm("¿Eliminar este apartamento?")) {
    apartamentos.splice(i, 1);
    guardar();
    render();
  }
}

function actualizarNombre(i, v) {
  apartamentos[i].nombre = v;
  guardar();
}

function actualizarIngreso(i, campo, v) {
  apartamentos[i].ingreso[campo] = campo === "monto" ? Number(v || 0) : v;
  guardar();
  render();
}

function render() {
  monedaLabel.innerText =
    moneda === "CRC" ? "Moneda: Colones ₡" : "Moneda: Dólares $";

  lista.innerHTML = "";

  apartamentos.forEach((a, i) => {
    const totalGastos = a.gastos.reduce((s, g) => s + g.monto, 0);
    const ganancia = a.ingreso.monto - totalGastos;

    lista.innerHTML += `
      <div class="card apartment">
        <span class="delete-apartment" onclick="eliminarApartamento(${i})">✖</span>

        <input value="${a.nombre}" oninput="actualizarNombre(${i}, this.value)">

        <input type="number" inputmode="numeric" value="${a.ingreso.monto}"
          oninput="actualizarIngreso(${i}, 'monto', this.value)">
        <input value="${a.ingreso.desc}"
          oninput="actualizarIngreso(${i}, 'desc', this.value)"
          placeholder="Descripción ingreso">

        <div class="small">Ingreso: ${formato(a.ingreso.monto)}</div>

        <div class="row">
          <input id="gastoMonto-${i}" type="number" inputmode="numeric" placeholder="Monto gasto">
          <input id="gastoDesc-${i}" placeholder="Descripción gasto">
          <button onclick="agregarGasto(${i})">Agregar gasto</button>
        </div>

        ${a.gastos.map((g, gi) => `
          <div class="item">
            <div>
              ${formato(g.monto)}
              <div class="small">${g.desc || ""}</div>
            </div>
            <span style="color:red;cursor:pointer"
              onclick="eliminarGasto(${i}, ${gi})">✖</span>
          </div>
        `).join("")}

        <div class="total">Total gastos: ${formato(totalGastos)}</div>
        <div class="total">Ganancia: ${formato(ganancia)}</div>
      </div>
    `;
  });
}

render();
</script>

</body>
</html>