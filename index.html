<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Control de Apartamentos</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  font-family: Arial, sans-serif;
  background: #f3f4f6;
  padding: 20px;
}

h1 { text-align:center; }

.card {
  background: #fff;
  padding: 15px;
  border-radius: 10px;
  margin-bottom: 15px;
  box-shadow: 0 4px 10px rgba(0,0,0,.08);
}

input, button {
  padding: 8px;
  margin: 4px 0;
}

button {
  background: #2563eb;
  color: #fff;
  border: none;
  border-radius: 6px;
  cursor: pointer;
}

.apartment {
  border: 1px solid #ddd;
  border-radius: 8px;
  padding: 10px;
  margin-top: 10px;
}

.row {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}

.row input {
  flex: 1;
}

.gasto {
  display: flex;
  justify-content: space-between;
  font-size: 14px;
  background: #f9fafb;
  padding: 4px 6px;
  border-radius: 5px;
  margin-top: 4px;
}

.delete {
  color: red;
  cursor: pointer;
}

.total {
  font-weight: bold;
  margin-top: 8px;
}
</style>
</head>

<body>

<h1>Control de Apartamentos</h1>

<div class="card">
  <h3>Nuevo apartamento</h3>
  <input id="nuevoNombre" placeholder="Nombre del apartamento">
  <input id="nuevoIngreso" type="number" placeholder="Ingreso mensual">
  <button onclick="agregarApartamento()">Agregar apartamento</button>
</div>

<div class="card">
  <button onclick="cambiarMoneda()">Cambiar moneda</button>
  <span id="monedaLabel"></span>
</div>

<div id="lista"></div>

<script>
let moneda = localStorage.getItem("moneda") || "CRC";
let apartamentos = JSON.parse(localStorage.getItem("apartamentos")) || [];

function guardar() {
  localStorage.setItem("apartamentos", JSON.stringify(apartamentos));
  localStorage.setItem("moneda", moneda);
}

function formato(valor) {
  return new Intl.NumberFormat(
    moneda === "CRC" ? "es-CR" : "en-US",
    { style: "currency", currency: moneda }
  ).format(valor);
}

function cambiarMoneda() {
  moneda = moneda === "CRC" ? "USD" : "CRC";
  guardar();
  render();
}

function agregarApartamento() {
  const nombre = document.getElementById("nuevoNombre").value;
  const ingreso = Number(document.getElementById("nuevoIngreso").value);

  if (!nombre) return;

  apartamentos.push({
    nombre,
    ingreso,
    gastos: []
  });

  document.getElementById("nuevoNombre").value = "";
  document.getElementById("nuevoIngreso").value = "";
  guardar();
  render();
}

function agregarGasto(i) {
  const valor = Number(document.getElementById(`gasto-${i}`).value);
  if (!valor) return;
  apartamentos[i].gastos.push(valor);
  guardar();
  render();
}

function eliminarGasto(i, g) {
  apartamentos[i].gastos.splice(g, 1);
  guardar();
  render();
}

function actualizarNombre(i, v) {
  apartamentos[i].nombre = v;
  guardar();
}

function actualizarIngreso(i, v) {
  apartamentos[i].ingreso = Number(v);
  guardar();
  render();
}

function render() {
  document.getElementById("monedaLabel").innerText =
    moneda === "CRC" ? "Moneda: Colones (₡)" : "Moneda: Dólares ($)";

  const cont = document.getElementById("lista");
  cont.innerHTML = "";

  apartamentos.forEach((a, i) => {
    const totalGastos = a.gastos.reduce((x, y) => x + y, 0);
    const ganancia = a.ingreso - totalGastos;

    cont.innerHTML += `
      <div class="card apartment">
        <input value="${a.nombre}" oninput="actualizarNombre(${i}, this.value)">
        <input type="number" value="${a.ingreso}" oninput="actualizarIngreso(${i}, this.value)">

        <div class="row">
          <input id="gasto-${i}" type="number" placeholder="Nuevo gasto">
          <button onclick="agregarGasto(${i})">Agregar gasto</button>
        </div>

        ${a.gastos.map((g, gi) => `
          <div class="gasto">
            ${formato(g)}
            <span class="delete" onclick="eliminarGasto(${i}, ${gi})">✖</span>
          </div>
        `).join("")}

        <div class="total">Total gastos: ${formato(totalGastos)}</div>
        <div class="total">Ganancia: ${formato(ganancia)}</div>
      </div>
    `;
  });
}

render();
</script>

</body>
</html>
